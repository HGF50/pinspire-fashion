<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinspire Fashion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        function App() {
            const [pins, setPins] = useState(() => {
                const savedPins = localStorage.getItem('pinspire-pins');
                return savedPins ? JSON.parse(savedPins) : [];
            });
            const [showModal, setShowModal] = useState(false);
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [newPin, setNewPin] = useState({
                title: '',
                description: '',
                board: '',
                imageUrl: '',
                imageFile: null
            });
            const [error, setError] = useState('');
            const [isUploading, setIsUploading] = useState(false);
            
            // Configuration Cloudinary
            const cloudinaryConfig = {
                cloudName: 'dmrytexqw', // Votre cloud name
                uploadPreset: 'preset1' // Preset par d√©faut Cloudinary
            };
            
            // Fonction d'upload simplifi√©e vers Cloudinary
            const uploadImageToCloudinary = () => {
                return new Promise((resolve, reject) => {
                    setIsUploading(true);
                    
                    const widget = cloudinary.createUploadWidget({
                        cloudName: 'dmrytexqw',
                        uploadPreset: 'preset1',
                        folder: 'pinspire-fashion',
                        multiple: false,
                        maxFileSize: 5000000,
                        sources: ['local', 'camera']
                    }, (error, result) => {
                        setIsUploading(false);
                        
                        if (error) {
                            reject(error);
                            return;
                        }
                        
                        if (result.event === "success") {
                            resolve(result.info.secure_url);
                        }
                    });
                    
                    widget.open();
                });
            };
            
            // G√©rer l'URL pour la cat√©gorie s√©lectionn√©e
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const categoryFromUrl = urlParams.get('category');
                if (categoryFromUrl && categories.find(c => c.id === categoryFromUrl)) {
                    setSelectedCategory(categoryFromUrl);
                }
            }, []);
            
            useEffect(() => {
                const url = new URL(window.location);
                if (selectedCategory === 'all') {
                    url.searchParams.delete('category');
                } else {
                    url.searchParams.set('category', selectedCategory);
                }
                window.history.replaceState({}, '', url);
            }, [selectedCategory]);
            
            const categories = [
                { id: 'all', name: 'Tout', icon: 'üè†' },
                { id: 'classic-men', name: 'Classique Homme', icon: 'üëî' },
                { id: 'classic-women', name: 'Classique Femme', icon: 'üëó' },
                { id: 'casual-men', name: 'Casual Homme', icon: 'üëï' },
                { id: 'casual-women', name: 'Casual Femme', icon: 'üëö' },
                { id: 'elegant-men', name: '√âl√©gant Homme', icon: 'ü§µ' },
                { id: 'elegant-women', name: '√âl√©gant Femme', icon: 'üë∞' },
                { id: 'streetwear-men', name: 'Streetwear Homme', icon: 'üß¢' },
                { id: 'streetwear-women', name: 'Streetwear Femme', icon: 'üëü' },
                { id: 'bohemian-men', name: 'Boh√®me Homme', icon: 'üåø' },
                { id: 'bohemian-women', name: 'Boh√®me Femme', icon: 'üå∏' },
                { id: 'sporty-men', name: 'Sportif Homme', icon: 'üëü' },
                { id: 'sporty-women', name: 'Sportif Femme', icon: 'üëü' },
                { id: 'minimalist-men', name: 'Minimaliste Homme', icon: '‚ö™' },
                { id: 'minimalist-women', name: 'Minimaliste Femme', icon: '‚ö™' }
            ];
            
            const handleCreatePin = async () => {
                setError('');
                
                if (!newPin.title) {
                    setError('Veuillez ajouter un titre');
                    return;
                }
                
                if (!newPin.imageUrl) {
                    setError('Veuillez ajouter une image');
                    return;
                }
                
                if (!newPin.board) {
                    setError('Veuillez s√©lectionner une cat√©gorie');
                    return;
                }
                
                const pin = {
                    id: Date.now().toString(),
                    title: newPin.title,
                    description: newPin.description,
                    imageUrl: newPin.imageUrl, // URL Cloudinary persistante
                    author: {
                        name: 'Vous',
                        avatar: 'https://i.pravatar.cc/150?img=0'
                    },
                    board: newPin.board,
                    saves: 0,
                    isSaved: false,
                    height: Math.floor(Math.random() * 200) + 300
                };
                
                setPins(prev => {
                    const updatedPins = [pin, ...prev];
                    localStorage.setItem('pinspire-pins', JSON.stringify(updatedPins));
                    return updatedPins;
                });
                setNewPin({
                    title: '',
                    description: '',
                    board: '',
                    imageUrl: '',
                    imageFile: null
                });
                setShowModal(false);
            };
            
            const exportData = () => {
                const data = {
                    pins: pins,
                    exportDate: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `pinspire-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };
            
            const importData = (event) => {
                const file = event.target.files?.[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.pins && Array.isArray(data.pins)) {
                                setPins(data.pins);
                                localStorage.setItem('pinspire-pins', JSON.stringify(data.pins));
                                alert('Import r√©ussi ! ' + data.pins.length + ' v√™tements import√©s.');
                            } else {
                                alert('Format de fichier invalide');
                            }
                        } catch (error) {
                            alert('Erreur lors de l\'import : ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            
            const filteredPins = selectedCategory === 'all' 
                ? pins 
                : pins.filter(pin => pin.board === selectedCategory);
            
            return (
                <div className="min-h-screen">
                    <header className="bg-white shadow-sm sticky top-0 z-40">
                        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                            <h1 className="text-2xl font-bold text-red-600">Pinspire Fashion</h1>
                            <div className="flex gap-2">
                                <button 
                                    onClick={exportData}
                                    className="bg-gray-600 text-white px-4 py-2 rounded-full hover:bg-gray-700"
                                    title="Exporter les donn√©es"
                                >
                                    <i className="fas fa-download"></i>
                                </button>
                                <label className="bg-gray-600 text-white px-4 py-2 rounded-full hover:bg-gray-700 cursor-pointer" title="Importer les donn√©es">
                                    <i className="fas fa-upload"></i>
                                    <input
                                        type="file"
                                        accept=".json"
                                        onChange={importData}
                                        className="hidden"
                                    />
                                </label>
                                <button 
                                    onClick={() => setShowModal(true)}
                                    className="bg-red-600 text-white px-6 py-2 rounded-full hover:bg-red-700"
                                >
                                    <i className="fas fa-plus mr-2"></i>Cr√©er
                                </button>
                            </div>
                        </div>
                    </header>
                    
                    <div className="max-w-7xl mx-auto px-4 py-6">
                        <div className="flex gap-2 overflow-x-auto pb-2">
                            {categories.map(cat => (
                                <button 
                                    key={cat.id} 
                                    onClick={() => setSelectedCategory(cat.id)}
                                    className={`px-4 py-2 rounded-full whitespace-nowrap transition-colors ${
                                        selectedCategory === cat.id 
                                            ? 'bg-red-600 text-white' 
                                            : 'bg-white hover:bg-red-50'
                                    }`}
                                >
                                    <span className="mr-2">{cat.icon}</span>
                                    {cat.name}
                                </button>
                            ))}
                        </div>
                    </div>
                    
                    <main className="max-w-7xl mx-auto px-4 py-6">
                        {filteredPins.length === 0 ? (
                            <div className="text-center py-20">
                                <i className="fas fa-camera text-6xl text-gray-300 mb-4"></i>
                                <p className="text-xl text-gray-500 mb-4">
                                    {selectedCategory === 'all' ? 'Aucune publication pour le moment' : 'Aucune publication dans cette cat√©gorie'}
                                </p>
                                <button 
                                    onClick={() => setShowModal(true)}
                                    className="bg-red-600 text-white px-8 py-3 rounded-full hover:bg-red-700"
                                >
                                    <i className="fas fa-plus mr-2"></i>Ajouter votre premier v√™tement
                                </button>
                            </div>
                        ) : (
                            <div className="columns-2 md:columns-3 lg:columns-4 gap-4">
                                {filteredPins.map(pin => (
                                    <div key={pin.id} className="break-inside-avoid mb-4">
                                        <div className="bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-lg transition-shadow">
                                            <img 
                                                src={pin.imageUrl} 
                                                alt={pin.title} 
                                                className="w-full object-cover"
                                                style={{ height: `${pin.height}px` }}
                                            />
                                            <div className="p-3">
                                                <h3 className="font-medium text-sm truncate">{pin.title}</h3>
                                                <p className="text-xs text-gray-500">{pin.board}</p>
                                                <div className="flex items-center justify-between mt-2">
                                                    <div className="flex items-center gap-2">
                                                        <img 
                                                            src={pin.author.avatar} 
                                                            alt={pin.author.name}
                                                            className="w-6 h-6 rounded-full"
                                                        />
                                                        <span className="text-xs text-gray-600">{pin.author.name}</span>
                                                    </div>
                                                    <div className="flex items-center gap-1">
                                                        <i className="fas fa-heart text-xs text-red-500"></i>
                                                        <span className="text-xs text-gray-600">{pin.saves}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>
                    
                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full">
                                <h2 className="text-xl font-bold mb-4">Ajouter un v√™tement</h2>
                                
                                {error && (
                                    <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                                        <p className="text-red-600 text-sm font-medium">{error}</p>
                                    </div>
                                )}
                                
                                <div className="mb-4">
                                    <div
                                        className={`border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ${
                                            newPin.imageUrl 
                                                ? 'border-green-500 bg-green-50' 
                                                : 'border-gray-300 hover:border-red-500'
                                        } ${isUploading ? 'opacity-50 cursor-not-allowed' : ''}`}
                                        onClick={() => {
                                            if (!isUploading) {
                                                uploadImageToCloudinary()
                                                    .then(url => {
                                                        setNewPin(prev => ({
                                                            ...prev,
                                                            imageUrl: url
                                                        }));
                                                        setError('');
                                                    })
                                                    .catch(err => {
                                                        setError('Erreur lors de l\'upload: ' + err.message);
                                                    });
                                            }
                                        }}
                                    >
                                        {isUploading ? (
                                            <div className="space-y-3">
                                                <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto"></div>
                                                <p className="text-gray-600 font-medium">Upload en cours...</p>
                                            </div>
                                        ) : newPin.imageUrl ? (
                                            <div className="space-y-3">
                                                <img 
                                                    src={newPin.imageUrl} 
                                                    alt="Preview" 
                                                    className="w-full h-32 object-cover rounded mx-auto"
                                                />
                                                <p className="text-green-600 font-medium text-sm">Image upload√©e sur Cloudinary!</p>
                                            </div>
                                        ) : (
                                            <div className="space-y-3">
                                                <i className="fas fa-cloud-upload-alt text-3xl text-gray-400"></i>
                                                <p className="text-gray-600 font-medium">Cliquez pour uploader une image</p>
                                                <p className="text-xs text-gray-500">Stockage persistant sur Cloudinary</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                <input 
                                    type="text" 
                                    placeholder="Titre" 
                                    value={newPin.title}
                                    onChange={(e) => setNewPin(prev => ({ ...prev, title: e.target.value }))}
                                    className="w-full p-3 border rounded-lg mb-3" 
                                />
                                <select 
                                    value={newPin.board}
                                    onChange={(e) => setNewPin(prev => ({ ...prev, board: e.target.value }))}
                                    className="w-full p-3 border rounded-lg mb-3"
                                >
                                    <option value="">S√©lectionner une cat√©gorie</option>
                                    <option value="classic-men">Classique Homme</option>
                                    <option value="classic-women">Classique Femme</option>
                                    <option value="casual-men">Casual Homme</option>
                                    <option value="casual-women">Casual Femme</option>
                                    <option value="elegant-men">√âl√©gant Homme</option>
                                    <option value="elegant-women">√âl√©gant Femme</option>
                                    <option value="streetwear-men">Streetwear Homme</option>
                                    <option value="streetwear-women">Streetwear Femme</option>
                                    <option value="bohemian-men">Boh√®me Homme</option>
                                    <option value="bohemian-women">Boh√®me Femme</option>
                                    <option value="sporty-men">Sportif Homme</option>
                                    <option value="sporty-women">Sportif Femme</option>
                                    <option value="minimalist-men">Minimaliste Homme</option>
                                    <option value="minimalist-women">Minimaliste Femme</option>
                                </select>
                                <textarea 
                                    placeholder="Description" 
                                    value={newPin.description}
                                    onChange={(e) => setNewPin(prev => ({ ...prev, description: e.target.value }))}
                                    className="w-full p-3 border rounded-lg mb-3" 
                                    rows="3"
                                ></textarea>
                                <div className="flex gap-3">
                                    <button 
                                        onClick={() => {
                                            setShowModal(false);
                                            setNewPin({
                                                title: '',
                                                description: '',
                                                board: '',
                                                imageUrl: '',
                                                imageFile: null
                                            });
                                        }}
                                        className="flex-1 py-3 border rounded-lg hover:bg-gray-50"
                                    >
                                        Annuler
                                    </button>
                                    <button 
                                        onClick={handleCreatePin}
                                        className="flex-1 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700"
                                    >
                                        Publier
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
